export default(async(t=null)=>{if(isObj(t)){let a=Object.keys(coreData.spa)[0],e=t.hasOwnProperty("spa")?t.spa:!!isObj(coreData.spa)&&a,i=isObj(coreData.spa)?e&&coreData.spa.hasOwnProperty(e)?coreData.spa[e]:coreData.spa[a]:null,s=t.hasOwnProperty("component")?t.component:null,p=t.hasOwnProperty("api")&&isObj(t.api)?t.api:i?.api||null,r=t.hasOwnProperty("path"),l=t.hasOwnProperty("it")&&isElem(t.it);coreData.events?.prestate&&(r||l)&&!t.path.startsWith("#")&&p&&prestate();let n={api:p,spa:e};if(l){let h=t.it.getAttribute("href")?.trim();t.path=r?t.path:h||null;let o=t.it.getAttribute("data-spa-api")?.trim();if(0===(o=o?toBuild(o):0)&&!t.hasOwnProperty("api")&&(o=null,h&&!h.startsWith("#"))){let u=t.it.getAttribute("data-spa-use")?.trim()||null;o=replValApi(o=(u=u&&coreData.spa.hasOwnProperty(u)?u:null)&&coreData.spa[u].api?cloneObj(coreData.spa[u].api):cloneObj(i?.api),t.it,!1)}let f=t.it.getAttribute("data-spa-mode")?.trim();f=f?"false"!==f&&(["before","after","begin","end"].includes(f)?f:toBuild(f)):0;let $=t.it.getAttribute("data-spa-loader")?.trim();$?($.startsWith("[")||($=`[${$}]`),$=toBuild($)):$=0,$&&isArr($)&&($.forEach((a,e,i)=>{isStr(a)&&a.startsWith("@@")&&(i[e]=t.it.$(a.slice(2),!0))}),1===($=$.flat()).length&&($=$[0]));let c=t.it.getAttribute("data-spa-scroll")?.trim();if(c){if("false"===c)c=!1;else if("true"===c)c=!0;else if(isObj(c=toBuild(c)))for(let d in c)c.hasOwnProperty(d)&&["it","target"].includes(d)&&isStr(c[d])&&c[d].startsWith("@@")&&(c[d]=t.it.$(c[d].slice(2),!0))}else c=0;let m=t.it.getAttribute("data-spa-update")?.trim();if(m){if(["[","{"].includes(m[0])||(m=m.includes(":")?`{${m}}`:`[${m}]`),isArr(m=toBuild(m)))m.forEach((a,e,i)=>{isStr(a)&&a.startsWith("@@")&&(i[e]=t.it.$(a.slice(2),!0))}),1===(m=m.flat()).length&&(m=m[0]);else if(isObj(m))for(let w in m)m.hasOwnProperty(w)&&isStr(m[w])&&m[w].startsWith("@@")&&(m[w]=t.it.$(m[w].slice(2),!0));else m=isStr(m[key])&&m.startsWith("@@")?t.it.$(m.slice(2),!0):null}else m=0;0!==o&&(n.api=o),0!==m&&(n.update=m),0!==$&&(n.loader=$),0!==f&&(n.mode=f),0!==c&&(n.scroll=c)}if(t.path){if(t.path.startsWith("#"))await state({path:`${location.pathname||"/"}${location.search}${t.path}`,spa:null,component:null});else{if(!(n.api&&await content(n)))return!1;let y={};for(let O in coreData.spa)coreData.spa.hasOwnProperty(O)&&coreData.spa[O].hasOwnProperty("api")&&l&&(y[O]=replValApi(cloneObj(coreData.spa[O].api),t.it,!1));coreData.events?.spa&&evt.run("spa",{path:t.path,spa:e,component:s,api:n.api}),await state({path:t.path,spa:e,component:s,api:n.api,others:y})}return!0}}return!1});