export default(async(e,t,i)=>{let n=i[1],l=null;if(("add"===e||"remove"===e)&&(l=await i[1].toString().hash(),coreData.eventAdd[i[0]]||=[],coreData.evtAdd[i[0]]||=[],n=async e=>{let t=e.target||null,n=isElem(t);coreData.events[i[0]]&&(!n||checkOff(t,i[0]))&&(n&&(e.it=t,e.itType=i[0],"submit"===i[0]&&(e.form=await formObj(t))),i[1](e))}),"add"===e){let[a,s,d,f,r,o,v,h]=i;d=void 0!==d&&d;let u=(e=[],t=[])=>e?.length===t?.length&&e.every((e,i)=>e===t[i]);if(a&&isFn(s)){let c=!0;if(["ready","DOMContentLoaded"].includes(a))coreData.events?.ready&&("loading"===document.readyState?dEvent("DOMContentLoaded",s):s());else if("load"===a)coreData.events?.load&&("complete"===document.readyState?s():wEvent("load",s));else if(["spa","init","api","content","state","prestate","stream"].includes(a)){for(let g of coreData.evtAdd[a])if(await g.fn.toString().hash()===l){c=!1;break}c&&coreData.evtAdd[a].push({it:null,fn:s,currFn:n,phase:null})}else if("mutation"===a){let A=f(t)?r(t):[$("html")],b=hasArr(A)&&1===A.length?A[0]:A;for(let p of coreData.eventAdd[a])if((isElem(b,p.it)&&b===p.it||isArr(b,p.it)&&u(b,p.it))&&await p.fn.toString().hash()===l){c=!1;break}c&&(d&&isObj(d)||(d=h),A.forEach(e=>{let t=new MutationObserver(t=>{coreData.events?.[a]&&checkOff(e,a)&&t.forEach(t=>{t.it=e,t.itType=a,s(t)})});coreData.eventAdd[a].push({it:b,fn:s,obs:t}),coreData.events?.[a]&&t.observe(e,d)}))}else if("resize"===a&&f(t)){let m=r(t),w=hasArr(m)&&1===m.length?m[0]:m;for(let _ of coreData.eventAdd[a])if((isElem(w,_.it)&&w===_.it||isArr(w,_.it)&&u(w,_.it))&&await _.fn.toString().hash()===l){c=!1;break}c&&m.forEach(e=>{let t=new ResizeObserver(t=>{coreData.events?.[a]&&checkOff(e,a)&&t.forEach(t=>{t.it=e,t.itType=a,s(t)})});coreData.eventAdd[a].push({it:w,fn:s,obs:t}),coreData.events?.[a]&&t.observe(e)})}else if(["visible","invisible"].includes(a)&&f(t)){let E=r(t),y=hasArr(E)&&1===E.length?E[0]:E;for(let S of coreData.eventAdd[a])if((isElem(y,S.it)&&y===S.it||isArr(y,S.it)&&u(y,S.it))&&await S.fn.toString().hash()===l){c=!1;break}if(c){if(!d||!isObj(d)){let k={root:null,rootMargin:"0px",threshold:0};d="visible"===a?isObj(coreData.events?.visible)?coreData.events.visible:k:isObj(coreData.events?.invisible)?coreData.events.invisible:k}E.forEach(e=>{let t=new IntersectionObserver((t,i)=>{coreData.events?.[a]&&checkOff(e,a)&&t.forEach(t=>{("visible"===a&&t.isIntersecting||"invisible"===a&&!t.isIntersecting)&&(t.it=e,t.itType=a,s(t))})},d);coreData.eventAdd[a].push({it:y,fn:s,obs:t}),coreData.events?.[a]&&t.observe(e)})}}else{let L=isWindow(t)?window:isDocument(t)?document:f(t)?r(t):o.document.includes(a)?document:o.window.includes(a)||v.window.includes(a)?window:document,O=hasArr(L)&&1===L.length?L[0]:L;if(null===d){for(let T of coreData.evtAdd[a])if(await T.toString().hash()===l){c=!1;break}c&&coreData.evtAdd[a].push({it:O,fn:s,currFn:n,phase:d})}else{for(let j of coreData.eventAdd[a])if((isWindow(L)&&isWindow(j.it)||isDocument(L)&&isDocument(j.it)||isElem(O,j.it)&&O===j.it||isArr(O,j.it)&&u(O,j.it))&&await j.fn.toString().hash()===l&&d==d){c=!1;break}if(c&&(coreData.eventAdd[a].push({it:O,fn:s,currFn:n,phase:d}),coreData.events?.[a])){let M=coreData.eventAdd[a][coreData.eventAdd[a].length-1];toArr(L).forEach(e=>{e.addEventListener(a,M.currFn,M.phase)})}}}}}else if("remove"===e){let[x,z,C,D,F,I,P]=i;if(C=void 0!==C&&C,x&&isFn(z)){if(["spa","init","api","content","state","prestate","stream","ready"].includes(x)){if(hasArr(coreData.evtAdd?.[x])){for(let q=0;q<coreData.evtAdd[x].length;q++)if(await coreData.evtAdd[x][q].fn.toString().hash()===l){coreData.evtAdd[x].splice(q,1);break}}}else if("mutation"===x||["resize","visible","invisible"].includes(x)&&D(t)){if(hasArr(coreData.eventAdd?.[x])){let B="mutation"===x&&!D(t),G=B?[$("html")]:new Set(F(t));coreData.eventAdd[x]=(await Promise.all(coreData.eventAdd[x].map(async e=>(B?e.it===$("html"):G.has(e.it))&&await e.fn.toString().hash()===l?(e.obs.disconnect(),null):e))).filter(Boolean)}}else{let H=isWindow(t)?window:isDocument(t)?document:D(t)?F(t):I.document.includes(x)?document:I.window.includes(x)||P.window.includes(x)?window:document;if(null===C){let J=null,K=0;if(hasArr(coreData.evtAdd?.[x])){for(let N=0;N<coreData.evtAdd[x].length;N++)if(await coreData.evtAdd[x][N].fn.toString().hash()===l){J=coreData.evtAdd[x][N],K=N;break}}if(null!==J){let Q=hasArr(H)&&1===H.length?H[0]:H;(isWindow(H)&&isWindow(J.it)||isDocument(H)&&isDocument(J.it)||isElem(Q,J.it)&&Q===J.it||isArr(Q,J.it)&&equalEl(Q,J.it))&&coreData.evtAdd[x].splice(K,1)}}else{let R=null;if(hasArr(coreData.eventAdd?.[x])){for(let U of coreData.eventAdd[x])if(await U.fn.toString().hash()===l){R=U;break}}null!==R?toArr(H).forEach(e=>e.removeEventListener(x,R.currFn||z,R.phase)):toArr(H).forEach(e=>e.removeEventListener(x,z,C))}}}}else if("has"===e){let[V,W,X,Y,Z,ee]=i;if(V=W(X(V)),Y(t)){let et=Z(t);return V?.length?!et.some(e=>"false"===e.dataset.event||ee(e.dataset.off).some(e=>V.includes(e))):et.every(e=>!e.matches('[data-event="false"]'))}if(!V?.length)return null;{let ei=Object.values(V.reduce((e,t)=>(e[t]=coreData.events?.[t]??!1,e),{})).every(Boolean);return!!ei}}else if("on"===e){let[en,el,ea,es,ed,ef]=i;if(en=el(ea(en)),es(t))en?.length?ed(t).forEach(e=>{e.dataset.event="true";let t=ef(e.dataset.off).filter(e=>!en.includes(e));t.length?e.dataset.off=t.join(", "):e.removeAttribute("data-off")}):ed(t).forEach(e=>{e.dataset.event="true",e.removeAttribute("data-off")});else if(coreData.events||={},en?.length)en.forEach(e=>coreData.events[e]||=!0);else for(let er in coreData.events)coreData.events.hasOwnProperty(er)&&!coreData.events[er]&&(coreData.events[er]=!0)}else if("off"===e){let[eo,ev,eh,eu,ec,eg]=i;if(eo=ev(eh(eo)),eu(t))eo?.length?ec(t).forEach(e=>{e.dataset.event="true";let t=eg(e.dataset.off);eo.forEach(e=>{t.includes(e)||t.push(e)}),e.dataset.off=t.join(", ")}):ec(t).forEach(e=>e.dataset.event="false");else if(coreData.events||={},eo?.length)eo.forEach(e=>coreData.events[e]=!1);else for(let eA in coreData.events)coreData.events.hasOwnProperty(eA)&&(coreData.events[eA]=!1)}else if("toggle"===e){let[eb,ep,em,ew,e$,e_]=i,eE=eb.includes(!0),ey=eb.includes(!1);if(eb=ep(em(eb)),isObj(t)){if(!eb?.length)return null;{let eS=eb.reduce((e,t)=>(coreData.events&&(e[t]=eE||ey?eE:!coreData.events[t],eE||ey?eE?evt.on(t):evt.off(t):coreData.events[t]?evt.off(t):evt.on(t)),e),{});return len(eS)>1?eS:Object.values(eS)[0]}}{if(!ew(t))return null;let ek=e$(t);if(eb?.length){if(ek.forEach(e=>{e.dataset.event="true";let t=e_(e.dataset.off);eb.forEach(e=>{t.includes(e)||ey?t.includes(e)&&!eE&&(t=t.filter(t=>t!==e)):t.push(e)}),t.length?e.dataset.off=t.join(", "):e.removeAttribute("data-off")}),isElem(t)&&1===eb.length)return eE||ey?eE:!e_(ek[0].dataset.off).includes(eb[0])}else if(ek.forEach(e=>{e.removeAttribute("data-off"),(eE||ey?ey:!e.matches('[data-event="false"]'))?e.dataset.event="false":e.dataset.event="true"}),isElem(t))return eE||ey?eE:!t.matches('[data-event="false"]')}}});