export default(async(e={})=>{try{let{api:t=null,update:a=null,loader:l=null,mode:r=!0,scroll:s=!1,spa:o=!1}=e,n=isObj(coreData.spa)?o&&coreData.spa.hasOwnProperty(o)?coreData.spa[o]:coreData.spa[Object.keys(coreData.spa)[0]]:null;if(!(t=t||n?.api||null))return console.warn("Failed to retrieve content: ",e),!1;if(o&&!e.hasOwnProperty("update")&&n?.update){if(isArr(n.update))a=[],n.update.forEach(e=>a.push($(e)));else if(isObj(n.update))for(let i in a={},n.update)n.update.hasOwnProperty(i)&&(isArr(n.update[i])?(a[i]=[],n.update[i].forEach(e=>a[i].push($(e)))):a[i]=$(n.update[i]));else a=$(n.update)}r=!!(isObj(r)||["before","after","begin","end"].includes(r))&&r,r=o&&!e.hasOwnProperty("mode")&&n?.mode?n.mode:r,o&&!e.hasOwnProperty("loader")&&(n?.loader?isArr(n.loader)?(l=[],n.loader.forEach(e=>l.push($(e))),l=l.filter(Boolean)):l=$(n.loader):l=$it[`loader:${o}`]),l&&(isArr(l)?l.forEach(e=>e?.attr.set("aria-busy","true")):l.attr.set("aria-busy","true"));let p=await api(t);if(p){let u=e=>{let t=e.tagName?.toLowerCase().trim();if(!t)return!0;let a=e.getAttribute("rel")?.toLowerCase().trim(),l=e.getAttribute("property")?.toLowerCase().trim(),r=e.getAttribute("itemprop")?.toLowerCase().trim(),s=e.getAttribute("name")?.toLowerCase().trim();return!("link"===t&&["stylesheet","manifest","icon","mask-icon","apple-touch-icon","apple-touch-icon-precomposed","shortcut","shortcut icon","icon shortcut"].includes(a)||"meta"===t&&(["og:image:secure_url","og:image"].includes(l)||["image"].includes(r)||["msapplication-tileimage"].includes(s)))},c=(e=null,n=null,i=null)=>{if(e&&n){if("head"===e.tagName.toLowerCase()){let c=new DOMParser().parseFromString(n,"text/html")?.$("head :: ?");if(hasArr(c)){let d=$("head"),f=d.$(":: ?").reduce((e,t)=>(u(t)?t.remove():e.push(t.outerHTML),e),[]);for(let h=c.length-1;h>=0;h--)(u(c[h])||!f.includes(c[h].outerHTML))&&$.insert(d,c[h],"begin",!0)}}else{let g=!i&&isStr(r)?r:isStr(i)&&isObj(r)&&r.hasOwnProperty(i)&&["before","after","begin","end"].includes(r[i])?r[i]:!!isStr(r)&&r;if(g?e.html(n,g):e.innerHTML=n,coreData.events?.content&&e.hasAttribute("data-content")&&!e.matches('[data-event="false"]')&&checkOff(e,"content")){let m=evDone(e.getAttribute("data-call-content"),e.getAttribute("data-calls-content"));if(m.doneCan){e.setAttribute("data-calls-content",m.doneNew);let y={it:e,calls:m.doneNew,api:t,update:a,loader:l,mode:r,scroll:s,spa:o,result:p,type:"content"};evRate(e.getAttribute("data-debounce-content"),e.getAttribute("data-throttle-content"))?rateBuild.fn(y,"content"):build(y,"content")}}}}};if(isArr(a))a.forEach(e=>c(e,p,null));else if(isElem(a))c(a,p,null);else if(isObj(p,a)){for(let d in a)if(a.hasOwnProperty(d)){let f=d.split(".").reduce((e,t)=>e&&e[t],p);isTrue(f)&&(isArr(a[d])?a[d]:[a[d]]).forEach(e=>c(e,f,d))}}else if(isObj(a)){let h=Object.values(a)[0];isElem(h)&&c(h,p,null)}else isObj(p)&&p.each((e,t)=>{if(isStr(e)||isNum(e)){let a=t.join("."),l=$(`[data-it="${a}"] ?`);l.length&&l.forEach(t=>c(t,e,a))}},!0);if(await init(o?"spa":"content"),s){if(isObj(s)){let g={target:s.target||null,speed:s.speed??300,type:s.type||"smooth",align:s.align||"top",offset:s.offset||0,axis:s.axis||"Y"};s.it&&isElem(s.it)?s.it.toScroll(g):toScroll(g)}else toScroll({target:null,speed:300,type:"smooth",align:"top",offset:0,axis:"Y"})}else if(o&&isObj(coreData.spa)&&coreData.spa.hasOwnProperty(o)&&coreData.spa[o].scroll){if(isObj(coreData.spa[o].scroll)){let m={target:coreData.spa[o].scroll.target?$(coreData.spa[o].scroll.target):null,speed:coreData.spa[o].scroll.speed??300,type:coreData.spa[o].scroll.type||"smooth",align:coreData.spa[o].scroll.align||"top",offset:coreData.spa[o].scroll.offset||0,axis:coreData.spa[o].scroll.axis||"Y"};coreData.spa[o].scroll.it?$(coreData.spa[o].scroll.it)?.toScroll(m):toScroll(m)}else toScroll({target:null,speed:300,type:"smooth",align:"top",offset:0,axis:"Y"})}}if(l&&(isArr(l)?l.forEach(e=>e?.attr.set("aria-busy","false")):l.attr.set("aria-busy","false")),p)return coreData.events?.content&&evt.run("content",{api:t,update:a,loader:l,mode:r,scroll:s,spa:o,result:p}),p;return console.warn("Failed to retrieve content: ",e),!1}catch{return console.warn("Failed to retrieve content: ",e),!1}});