export default(async t=>{if(coreData.events?.prestate&&prestate(),coreData.spa&&isObj(coreData.spa)){let a=t.state;coreData.state.length>=coreData.cache.state&&coreData.state.pop();let e=Object.keys(coreData.spa)[0],s=!0;if(!a){s=!1;let p=`${location.pathname||"/"}${location.search}`,n=replValApi(cloneObj(coreData.spa[e]?.api),p,!0);a={path:p,api:n}}coreData.state[0]?.path!==a.path&&coreData.state.unshift(a);let r=coreData.state.length>=2?coreData.state[1]:null,l=a.spa&&coreData.spa[a.spa]?a.spa:e,h=a.api;if(a.hasOwnProperty("others")&&isObj(a.others)&&(!r||r.spa!==a.spa)){for(let o in coreData.spa)if(coreData.spa.hasOwnProperty(o)&&a.others.hasOwnProperty(o)&&(!r||[r.spa,a.spa].includes(o))){l=o,h=a.others[o];break}}if(a.path&&-1===a.path.indexOf("#")&&!location.hash&&h&&r?.path?.split("#")[0]!==a.path){let i=a.hasOwnProperty("component")&&isStr(a.component);(!s||i)&&$(`a[href="${a.path}"][data-spa] ?`)?.forEach(t=>{if((!s||t.getAttribute("data-spa")?.replace(/\s+/g,"")===a.component?.replace(/\s+/g,""))&&checkOff(t,"spa")){let e=evDone(t.getAttribute("data-call-spa"),t.getAttribute("data-calls-spa"));if(e.doneCan){t.setAttribute("data-calls-spa",e.doneNew);let p={it:t,calls:e.doneNew,type:"spa",itType:"popstate"};evRate(t.getAttribute("data-debounce-spa"),t.getAttribute("data-throttle-spa"))?rateBuild.fn(p,"spa"):build(p,"spa")}}});let c=!!r&&r.path,u=await content({api:h,mode:!1,spa:l});(!c||c?.split("#")[0]!==a.path)&&u&&coreData.events?.spa&&evt.run("spa",a)}coreData.events?.state&&evt.run("state",{current:a,previous:r})}coreData.events?.popstate&&(t.previous=coreData.state.length>=2?coreData.state[1]:null,evt.run("popstate",t))});